import{argv}from'yargs';import path from'path';import{searchIgnoreDirs,isPlugin,isBundle}from'../utils';var parameters=argv.parameters?require(path.resolve(argv.parameters)):{};var specialArgv={};argv._.forEach(function(arg){if(arg.indexOf(':')>0){var argArr=arg.split(':');specialArgv[argArr[0]]=argArr[1];}});// 默认配置项
var defaultOptions=Object.assign({output:{path:'web/static-dist/',publicPath:'/static-dist/'},libs:{},noParseDeps:{},onlyCopys:[],global:{},externals:{jquery:'jQuery'},regExp:'react|webuploader|postal|lodash',minChunks:5,commonsChunkFileName:'common',entryMainName:'main',entryFileName:'index',extryCssName:'main',baseName:'libs/base',globalDir:'app/Resources/static-src',nodeModulesDir:'node_modules',pluginsDir:'plugins',bundlesDir:'src',activitiesDir:'activities',themesDir:'web/themes',fontlimit:1024,imglimit:1024,fontName:'fonts',imgName:'img',mediaName:'media',copyName:'img',isESlint:true,isNeedCommonChunk:'.is-need-common-chunk'},parameters);// 绝对路径
var rootDir=path.resolve('./');var globalDir=path.resolve(rootDir,defaultOptions.globalDir);var nodeModulesDir=path.resolve(rootDir,defaultOptions.nodeModulesDir);var pluginsDir=path.resolve(rootDir,defaultOptions.pluginsDir);var themesDir=path.resolve(rootDir,defaultOptions.themesDir);var bundlesDir=path.resolve(rootDir,defaultOptions.bundlesDir);var activitiesDir=path.resolve(rootDir,defaultOptions.activitiesDir);// 是否编译相应模块
var isBuildAllModule=!!specialArgv.module?false:true;var argvModule=specialArgv.module?specialArgv.module.split(','):[];var buildModule=[];argvModule.forEach(function(item){if(isPlugin(item)){buildModule.push(path.resolve(pluginsDir,item));}else if(isBundle(item)){buildModule.push(path.resolve(bundlesDir,item));}else{buildModule.push(path.resolve(themesDir,item));}});// 是否watch相应模块
var isWatchAllModule=!!specialArgv.watch?false:true;var watchModule=specialArgv.watch?specialArgv.watch.split(','):[];var ignoredDirs=[];if(!isWatchAllModule){ignoredDirs=ignoredDirs.concat([globalDir],searchIgnoreDirs(pluginsDir,watchModule),searchIgnoreDirs(bundlesDir,watchModule),searchIgnoreDirs(themesDir,watchModule));}var options=Object.assign({},defaultOptions,{output:{path:path.resolve(rootDir,defaultOptions.output.path),publicPath:defaultOptions.output.publicPath},// 开发模式
__DEBUG__:specialArgv.sourcemap,__DEV__:process.env.NODE_ENV==='development',// 高级模式
__DEV_SERVER_PORT__:specialArgv.port||3030,__ANALYZER__:specialArgv.analyzer,__DEVTOOL__:specialArgv.sourcemap?'source-map':'cheap-module-eval-source-map',__VERBOSE__:specialArgv.verbose||false,rootDir:rootDir,globalDir:globalDir,nodeModulesDir:nodeModulesDir,pluginsDir:pluginsDir,themesDir:themesDir,bundlesDir:bundlesDir,activitiesDir:activitiesDir,isBuildAllModule:isBuildAllModule,buildModule:buildModule,isWatchAllModule:isWatchAllModule,ignoredDirs:ignoredDirs});export default options;